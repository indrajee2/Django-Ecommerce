{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="container py-5" >
     {% if messages %}
    {% for msg in messages %}
    <div class="alert alert-primary" role="alert">
            {{msg}}
    </div>
    {% endfor %}
    {% endif %}
    <div class="row">
        <!-- Product Images -->
        <div class="col-md-6 mb-4"  >
            {% if item  %} 
            <div class="card">
                <img src="{{item.image.url}}"class="card-img-top" alt="Product Image" height="600px">
                <div class="card-body">
                </div>
            </div>
        </div>
        
        <!-- Product Details -->
        <div class="col-md-6">
            <h1 class="h2 mb-3"> {{item.name}}</h1>
            <div class="mb-3">
                <span class="h4 me-2 price"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-currency-rupee" viewBox="0 0 16 16">
                <path d="M4 3.06h2.726c1.22 0 2.12.575 2.325 1.724H4v1.051h5.051C8.855 7.001 8 7.558 6.788 7.558H4v1.317L8.437 14h2.11L6.095 8.884h.855c2.316-.018 3.465-1.476 3.688-3.049H12V4.784h-1.345c-.08-.778-.357-1.335-.793-1.732H12V2H4z"/>
            </svg>{{item.discounted_price}}</span>
                 <span class="text-muted text-decoration-line-through">{{item.price}}</span>
                <span class="badge bg-danger ms-2">{{item.get_discount_price}}%</span>
            </div>
            
            <div class="mb-3">
                <div class="d-flex align-items-center">
                    <span class="text-muted">(128 reviews)</span>
                </div>
            </div>
            
            <p class="mb-4">{{item.description}}</p>
             <div class="mb-4">
                <h5>Size:</h5>
                
                {% if item.size %}
                {% for i in item.size.all  %}
                   <!-- <input type="radio" class="btn-check size"   value="{{ i.id }}" required > -->
                    <label class="btn btn-outline-secondary size-btn" data-id="{{i.id}}">{{ i.name }}</label>
                {% endfor %}
                {% endif %}
                   <div class="selectsize-alert" style="color: red;"></div>
                 </div> 
                <!-- Quantity -->
                 <div class="mb-4">
                     <button class="btn btn-outline-danger minus-btn" type="button" data-id="{{ item.id }}">-</button>
                    <span class="btn btn-primary item-quantity" data-id="{{ item.id }}">1</span>
                    <button class="btn btn-outline-success plus-btn" type="button" data-id="{{ item.id }}">+</button>
         
                </div> 
                
                <!-- Actions -->
                <div class="d-grid gap-2">
                    {% if cart %}
                    <button class="btn btn-primary add_cart" type="button" data-id="{{ item.id }}">Go to Cart</button>
                    {% else %}
                    <button class="btn btn-primary add_cart" type="button" data-id="{{ item.id }}">Add to Cart</button>
                    
                    {% endif %}

                    {% if watchlist_items %}
                       
                    <button class="btn btn-danger watchlist" type="button"  data-id="{{ item.id }}">
                        Remove from watchlist
                    </button>
                    {% else %}
                    <button class="btn btn-success watchlist" type="button"  data-id="{{ item.id }}">
                        Add to watchlist
                    </button>
                    {% endif %}
                     <div class="alert alert-success watchlist-msg" role="alert">

                        </div>
                    {% comment %} <form action="/direct-buy/" method="POST" class="d-grid gap-2">
                       <button class="btn btn-secondary buy_now" type="button" id="checkout" data-id="{{ item.id }}">
                        Buy Now
                    </button> 
                    </form> {% endcomment %}

               
                </div>
                
                <!-- Additional Info -->
                <div class="mt-4">
                    <h5>You might be intrested in</h5>
                    {% for product in page_obj %}
                        
                    <a href="{% url 'product_detail' product.id %}"  style="text-decoration: none; color:black;"><div class="">
                       <img src="{{product.image.url}}" height="60px">
                       <i >{{product.name}}</i>
                       <P > <span class="h4 me-2 price"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-currency-rupee" viewBox="0 0 16 16">
                <path d="M4 3.06h2.726c1.22 0 2.12.575 2.325 1.724H4v1.051h5.051C8.855 7.001 8 7.558 6.788 7.558H4v1.317L8.437 14h2.11L6.095 8.884h.855c2.316-.018 3.465-1.476 3.688-3.049H12V4.784h-1.345c-.08-.778-.357-1.335-.793-1.732H12V2H4z"/>
            </svg>{{product.discounted_price}}</span></P>
                    </div></a>
                    {% endfor %}
                    <!-- paginator pages  -->
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center">

                            {% if product.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">&laquo;</span>
                            </li>
                            {% endif %}

                            {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                            {% else %}
                                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                            {% endif %}
                            {% endfor %}

                            {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">&raquo;</span>
                            </li>
                            {% endif %}

                        </ul>
                        </nav>

                    <!-- <div class="d-flex align-items-center">
                        <i class="fas fa-shield-alt text-primary me-2"></i>
                        <span>2-year warranty</span>
                    </div> -->
                </div>
            </div>
        </div>
        {% if user.is_authenticated %}
            
        <!-- comment section  -->
        <div class="col-md-12 col-lg-10 col-xl-8">
        <div class="card">
            <div class="card-body">
                <div class="d-flex flex-start align-items-center"></div>
                <div class="card-footer py-3 border-0" style="background-color: #f8f9fa;">
                    <div class="d-flex flex-start w-100">
                        {% if user.user_image %}
                            
                        <img class="rounded-circle shadow-1-strong me-3"
                        src="{{user.user_image.url}}" alt="avatar" width="40"
                        height="40" />
                        {% else %}
                        <img class="rounded-circle shadow-1-strong me-3"
                        src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp" alt="avatar" width="40"
                        height="40" />
                        {% endif %}
                         <div data-mdb-input-init class="form-outline w-100">
                            <textarea class="form-control content" rows="4" style="background: #fff;" required="true"></textarea>
                            <label class="form-label" for="textAreaExample">Message</label>
                        </div> 
                        
                    </div>
                    <div class="float-end mt-2 pt-1">
                        <button  type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary btn-sm comment" data-id="{{item.id}}">Post comment</button>
                        <button  type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-outline-primary btn-sm" onclick="history.back()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% if comment %}
    {% for post in comment %}
        
    <div class="col-md-12 col-lg-10 col-xl-8" >
        <div class="card">
            <div class="card-body"  style="background-color: #d2d9e0;">
                {% if post.user.user_image %}
                    <div class="d-flex flex-start align-items-center" >
                    <img class="rounded-circle shadow-1-strong me-3"
                    src="{{post.user.user_image.url}}" alt="avatar" width="60"
                    height="60" />
                    <div>
                        {% else %}
                        <div class="d-flex flex-start align-items-center">
                            <img class="rounded-circle shadow-1-strong me-3"
                            src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp" alt="avatar" width="60"
                            height="60" />
                            <div>
                                {% endif %}
                                <h6 class="fw-bold text-primary mb-1">{{post.user.username}}</h6>
                                <p class="text-muted small mb-0">
                                    {{post.comment_post}}
                                </p>
                            </div>
                        </div>
                        
                        <p class="mt-3 mb-4 pb-2">
                            {{post.content}}
                        </p>
                        
                        <h2 class="small d-flex justify-content-start">
                            {% if request.user == post.user %}
                            <a class="d-flex align-items-center me-3 btn btn-danger remove" data-id='{{post.id}}' >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                </svg>
                            </a>
                            {% endif %}
                            {% if request.user.is_authenticated %}
                            <button class="d-flex align-items-center me-3 btn btn-danger like-btn" data-id='{{post.id}}'>{% if request.user in post.like.all %}Unlike {% else %} like {% endif %}</button>
                            {% endif %} 
                            <p id="likes" style="color:red">likes {{post.like.count}}</p>
                          
                           
                        </h2>

            </div>
            
        </div>
    </div>
    {% endfor %}
    {% endif %}
</div>
</div>

    {% endif %}
    
{% endblock content %}


{% block scripts %}
<script>
    let commentpost_url= "{% url 'comment' %}"
    let commentremove_url="{% url 'comment_remove' %}"
    let commentlike_url="{% url 'like_comment' %}"
    {% comment %} let buynow_url="{% url 'buy' %}" {% endcomment %}
    let add_to_cart_url="{% url 'add_to_cart' %}"
    let csrf_token="{{csrf_token}}"
    let watchlist_url="{% url 'watchlist' %}"
</script>

{% endblock scripts %}
